## The Notion of Probability
扔一个硬币四次，想知道至少三次正面（头）朝上的概率。结果一共有$2^4=16$种，关心的结果的数量是五种，分别是$HHHH,HHHT,HHTH,HTHH,THHH$。那么至少三次正面向上的概率就是关心的结果个数比上总的结果的个数，$5/16$。这个形成概率概念的常识性做法，当然，稍微有点不严谨，比如没有说硬币是公平的，正面和反面向上的概率是相同的。  
**Definition 15.1.** 令$\Omega$是实验的某些序列的结果的有限集合，各个结果的发生是等概率的。令$A\subseteq \Omega$，那么$\Omega$称为样本空间(`sample space`)，$A$是事件(`event`)，那么比率
$$P(A)=\frac{|A|}{|\Omega |}$$
是事件$A$的概率。  
$P$是定义在$\Omega$的所有子集的结合上的函数，取值范围是$0\leq P(A)\leq 1$。  
当$A,\Omega$是无限集合的时候，这个定义是无意义的。这里我们只讨论有限集合的概率问题。  
如果$A,B$是$\Omega$的不相交子集，并且$|A\cup B|=|A|+|B|$，因此$P(A\cup B)=P(A)+P(B)$。一般地，$|A\cup B|=|A|+|B|-|A\cap B|$，蕴含$P(A\cup B)=P(A)+P(B)-P(A\cap B)$。进一步泛化可以得到下面这个简单但是有用的不等式。  
**Proposition 15.2.** 令$A_1,A_2,\cdots,A_n$来自同一个样本空间，那么
$$P(A_1\cup A_2\cup\cdots\cup A_n)\leq P(A_1)+P(A_2)+\cdots +P(A_n)$$
**Proof.** 上式等价于
$$|A_1\cup A_2\cup\cdots\cup A_n|\leq |A_1|+|A_2|+\cdots +|A_n|$$
左边对于至少属于其中一个$A_i$的样本空间的元素只计数了一次，而右边至少计数了一次。

三至七章有大量排列组合的例子和练习，它们能很容易的转化成概率的例子和练习。比如有多少个六位数包含数字6，可以变成随机取一个六位数字，包含6的概率是多少。所以这里就不再讨论这些基础问题。这一小节给出两个反直觉的例子。

**Example 15.3.** 彩票游戏。从36个数字中选择6个，至少选中一个中奖数字的概率是多少？  
**Solution.** 令$A$表示至少选中一个中奖数字，$B$表示不包含中奖数字。很明显，$A, B$是不相交的，且$A+B=\Omega$，所以$P(A)+P(B)=1$。因此我们计算$P(B)$的概率即可，$B$事件是从30个数字选择6个。
$$P(A)=1-P(B)=1-\frac{\begin{pmatrix}
30\\6
\end{pmatrix}}{\begin{pmatrix}
36\\6
\end{pmatrix}}=1-0.3048=0.6952$$
所以任意选择六个数字，至少有一个中奖数字的概率接近百分之七十。

如果$A, B$是不相交的，我们称之为互斥(`mutually exclusive`)。也就是说，$A, B$不可能同时发生。在此基础上，如果$A+B=\Omega$，那么$B$是$A$的补集(`complement`)，记作$\bar{A}=B$。

**Example 15.4.** 某个聚会上有四十个人，没有人是二月二十九号出生的。Adam向Bill提意玩一个游戏，每一个客人写下出生的月份和天，如果两个人是同一天则Adam赢，否则Bill赢。Bill看了看，只有四十个人，比一年的天数小多了，觉得自己会赢。实际情况呢？
**Solution.** Bill没有分清百分百会发生和大于百分之五十会发生。如果一定赢，那么需要366个人，但是超过一半的机会是完全不同的问题。  
下面会证明至少需要23个人，Adam大概率会赢，否则Bill会赢。  
至少有两人在同一天生日的补集是没有两个人的生日在同一天。第一个人可以是任意一天出生，365个可能性，第二个人不能是同一天，364个可能性，依此类推。23个人可能总数是$(365)_{23}$。所有可能的结果集有$365^{23}$。所有没有任何两个人的生日在同一天的概率是
$$\frac{365\cdot 364\cdots 343}{365^{23}}<\frac{1}{2}$$
所以超过一半的可能性是存在两个人的生日在同一天。  w
我们为什么要排除二月二十九号呢？因为这一天和其他天不等概率，闰年才会有这一天，几率是其他天的四分之一（近似）。那么为了使得样本空间是等概率的，需要考虑四年，$4\cdot 365+1=1461$天作为整个样本空间，使得论证过程会复杂很多。  
上面这个例子有时被称为生日悖论(`birthday paradox`)。

## Non-constructive Proofs
如果一个盒子里面装者一些球，随机挑一个是蓝球的概率大于0，那么至少有一个蓝球。这个看似简单实则很有用的。  
第十三章提到了`Ramsey number`$R(k,k)$，如果我们用两种颜色对$R(k,k)$个点的完全图染色，总能找到一个完全子图$K_k$是同色的。  
下面要证明下界$R(k,k)>2^{k/2}$。这个命题是说对$2^{k/2}$个顶点的完全图染色，可能不存在一种染色能够找到一个同色的完全子图$K_k$。第十三章的证明了$R(3,3)>5, R(5,5)>17$，明确找出了不符合题意的图。但是回到这个问题上，不需要这么严格。只需要证明上述所阐述的存在性即可，而不需要找到这样一种染色。  
**Theorem 15.5.** 对所有正整数$k\geq 3$，不等式$R(k,k)>2^{k/2}$都成立。  
**Proof.** 令$G=K_n$，对$G$按照如下方式染色：对于每条边而言，通过掷硬币的方式，如果正面向上染成红色，否则染成蓝色，每条边是红色或者蓝色的概率都是二分之一。我们将会证明没有同色完全子图$K_k$的概率是大于0的。$p=\frac{|F|}{|\Omega |}$，$\Omega$是$n$个顶点的完全图进行二染色的集合，$p>0$意味着至少有一个二染色的完全图$K_n$不包含同色完全子图$K_k$。  
我们会通过证明$1-p<1$来证明$p>0$。前者的意思是对$G$随机染色，至少有一个同色完全子图的概率。  
将$K_n$中的$K_k$子图二颜色的方式有$2^{\begin{pmatrix}k\\2\end{pmatrix}}$，其中有两个是同色的。所以随机对其染色是同色的概率是
$$\frac{2}{2^{\begin{pmatrix}k\\2\end{pmatrix}}}=2^{1-{\begin{pmatrix}k\\2\end{pmatrix}}}$$
$K_n$有$\begin{pmatrix}n\\k\end{pmatrix}$个$K_k$。每一个都有可能包含同色的子图。根据**Proposition 15.2**这些子图中至少有一个同色子图的概率最多是这些可能性之和。如果用$A_S$表示$G$的$K_k$子图$S$是同色的，那么
$$P(\bigcup_S A_S)\leq \sum_S P(A_S)=\begin{pmatrix}
n\\k
\end{pmatrix}2^{1-{\begin{pmatrix}k\\2\end{pmatrix}}}\tag{15.1}$$
代入$n\leq 2^{k/2},k\geq 3$
$$\begin{pmatrix}
n\\k
\end{pmatrix}2^{1-{\begin{pmatrix}k\\2\end{pmatrix}}}<\frac{n^k}{k!}2^{1-{\begin{pmatrix}k\\2\end{pmatrix}}}\leq\frac{2\cdot 2^{k^2/2}}{k!2^{\begin{pmatrix}
k\\2
\end{pmatrix}}}=2\cdot\frac{2^{k/2}}{k!}<1$$
最后一步使用递归法很容易证明。

第十三章证明了$R(k,k)\leq 4^k$，这里证明了$\sqrt{2}^k<R(k,k)$。基本上这是已知的`Ramsey numbers`最好的范围了。

**Theorem 15.6.** 令$m,n$是大于1的正整数，并且$m\geq 2\log_2 n$。对$K_{n,n}$进二染色，没有同色边的$K_{m,m}$是可能的。  
**Proof.** 对$K_{m,m}$进行二颜色的方式有$2^{m^2}$种，其中两种是单色的。那么至少有一个同色子图的概率最多是$\begin{pmatrix}n\\m\end{pmatrix}^2 2^{1-m^2}$，我们需要证明
$$\begin{pmatrix}n\\m\end{pmatrix}^2 2^{1-m^2}$$
也就是
$$2\begin{pmatrix}n\\m\end{pmatrix}^2<2^{m^2}$$
插入两个中间表达式
$$2\begin{pmatrix}n\\m\end{pmatrix}^2<n^{2m}\leq (2^{m/2})^{2m}=2^{m^2}$$
中间的不等式用到的就是题目中$m,n$的关系。

可以从另一个角度来解读这个问题。如果$m\geq 2\log_2 n$，那么存在一个元素是零或一的$n\times n$的矩阵，没有$m\times m$的子矩阵只包含零或者只包含一。  
事实上，前面的证明只是存在性，没有找到这么一个染色，对应到这里，我们不知道怎么构造这个矩阵来满足要求。换句话说，知道是可能的和知道怎么到之间有巨大的鸿沟。目前已知的当$m=c\sqrt{n}$时来构造满足要求的矩阵。但这距离我们证明为真的命题$m=2\log_2 n$之间也就很大的距离。

## Independent Events
### The Notion of Independence and Bayes' Theorem
扔两个骰子。$A$表示第一个骰子是六这个事件，$B$表示第二个骰子是六这个事件，那么$P(A)=P(B)=1/6, P(A\cap B)=1/36$，可以看出来$P(A)\cdot P(B)=P(A\cap B)$，这是个巧合吗？从$[12]$中任选一个数，$C$表示该数能被2整除，$D$表示概述能被3整除，$F$表示该数能被4整除。那么$P(C)=1/2,P(D)=1/3,P(F)=1/4$，接着可以计算得到$P(C\cap D)=1/6,P(D\cap F)=1/12$，看似乘积关系依旧成立。但是$P(C\cap F)=P(F)=1/4\neq P(C)P(F)$。  
为什么有时$P(A)\cdot P(B)=P(A\cap B)$但是有时$P(A)\cdot P(B)\neq P(A\cap B)$？因为有的时候$A$的发生增加或者减少了$B$发生的概率，有的时候$A$对$B$没有影响。回到前面从12个数中选择一个的问题。能被2整除增加了能被4整除的概率。全集从12个减少为6个，但是能被4整除的结果集个数没有变化。相反，能被2整除对能否被3整除没有影响。全集从12个减少到了6个，同时，能被3整数的结果集的个数也有相应的减少（从4个到2个）。

**Definition 15.7.** 如果事件$A,B$来自同一样本空间$\Omega$，有$P(A)\cdot P(B)=P(A\cap B)$，那么$A,B$称为独立事件(`independent events`)，否则是非独立事件(`dependent`)。

**Definition 15.8.** 令事件$A,B$来自同一样本空间，且假设$P(B)>0$，有
$$P(A|B)=\frac{P(A\cap B)}{P(B)}$$
$P(A|B)$是条件概率(`conditional probability`)，表示给定事件$B$发生的前提下$A$发生的概率。

**Proposition 15.9.** 事件$A,B$是独立事件等价于$P(A|B)=P(A)$成立。  
换句话说，事件$A,B$是独立的等价于$B$的发生不会使得$A$更容易或更不容以发生。

**Example 15.10.** 连续扔四次硬币。看不最后的结果，只知道至少有两次正面向上，问四次都向上的概率是多少？  
**Solution.** 令$A$表示四次正面向上，$B$表示至少两次正面向上，那么$A\cap B=A$。所以$P(A|B)=P(A)/P(B)$。每次扔掷硬币正面向上的概率是二分之一，所以$P(A)=\frac{1}{16}$。有$1/16$的几率四次正面向上，$4/16$的几率三次正面向上，$6/16$的几率两次正面向上，所以$P(B)=\frac{11}{16}$。$P(A|B)=\frac{1}{11}$。

**Example 15.11.** 令$p=p_1p_2p_3\cdots p_n$是一个随机挑选的$n$排列。令$A$事件是$p_1>p_2$，$B$事件是$p_2>p_3$。计算$P(A|B)$，$A,B$是否是独立事件？  
**Solution.** 明显$P(A)=P(B)=1/2$。$A\cap B$是$p_1>p_2>p_3$，概率是六分之一。因此
$$P(A|B)=\frac{P(A\cap B)}{P(B)}=\frac{1/6}{1/2}=\frac{1}{3}\neq P(A)$$
所以$A,B$不是独立事件。

你的第一反应$A,B$明显不是独立事件，因为如果$p_1>p_2$成立的话，那么$p_2$较小，所以$p_2>p_3$成立的可能性会小一些。当处理条件概率时利用直觉的话一定要小心。比如下面这个例子就和直觉相悖。  
**Example 15.12.** 一个大学两个学院，人文学院和工程学院，两个学院统计上学年申请人的情况，都是国内学生的入学比例比国际学生的高。那么对于整个大学而言，国内学生入学比例比国际学生高吗？  
**Solution.** 答案是不能。比如下表就是个反例。
|  |Liberal Arts|Engineering|Entire University|
|--|--|--|--|
|Domestic<br>applicants|Admitted: 10<br>Applied:120<br>success rate:8.3%|Admitted: 10<br>Applied:10<br>success rate:100%|Admitted: 20<br>Applied:130<br>success rate:15.9%|
|International<br>applicants|Admitted: 1<br>Applied:15<br>success rate:6.7%|Admitted: 90<br>Applied:100<br>success rate:90%|Admitted: 91<br>Applied:115<br>success rate:79.1%|

这个反例是著名的辛普森悖论(`Simpson's paradox`)。对工程学院而言，虽然国内学生入学比例高，但是国际学生占比非常高，国内学生的申清者只占全校国内学生申清总数的8%，国际学生的申请者占全校国际学生申请人数的85%以上。而人文学院恰恰相反，并且国际学生的申清人数很少，不会对国际学生的入学比例有大的影响，而国内学生的申清总数很大，入学比例低，一下子就大大减少了国内学生申清成功的比例。  
下面的贝叶斯定理可以给出更精准的解释。  
**Theorem 15.13 (Bayes' Theorem).** 令$A,B$是互斥事件，那么$A\cup B=\Omega$。令$C$为任意事件，那么
$$P(C)=P(C|A)\cdot P(A)+P(C|B)\cdot P(B)$$
也就是说$C$的概率是条件概率的加权平均数。  
**Proof.** 由于$A,B$互斥，那么$A\cap C$和$B\cap C$不相交，又因为$A\cup B=\Omega$，它们的并集就是$C$。因此
$$P(C)=P(A\cap C)+P(B\cap C)$$
上式右边的第一项（第二项）和要证明的等式右边的第一项（第二项）是相等的，就是条件概率的公式。

现在我们可以对前面的辛普森悖论有更深的理解了。令$A_1$表示事件——国际学生申请人文学院，$B_1$表示国内学生申请人文学院，类似的$A_2,B_2$表示申请工程学院，$C_1,C_2$表示国际学生、国内学生申请整个大学。根据**Theorem 15.13**
$$P(C_1)=P(C_1|A_1)\cdot P(A_1)+P(C_1|B_1)\cdot P(B_1)$$
$$P(C_2)=P(C_2|A_2)\cdot P(A_2)+P(C_2|B_2)\cdot P(B_2)$$
要求国内学生有更大的机会被任何一学院录取的标准确保了$P(C_1|A_1)<P(C_2|A_2),P(C_1|B_1)<P(C_2|B_2)$。但是对任意$P(A_1),P(B_1)$（$A_2$是$A_1$的补集，$B_2$是$B_1$的补集）而言，命题能不成立呢？我们可以选择$A_1,B_1$对$P(C_1)$非常有利且对$P(C_2)$非常不利。怎么选择呢？如果$P(C_1|A_1)$很大，选择一个很大的$P(A_1)$，反之$P(C_1|A_1)$很小的话，可以选择一个很小的$P(A_1)$；选择$P(B_1)$也类似。  
换句话说，加权平均值比非加权平均值难控制的多。事实上，如果要求$P(A_1)=P(B_1)=1/2$，甚至只要求$P(A_1)=P(B_1)$，那么对于整个大学而言，国内学生的入学比更高。

**Example 15.14.** 假设有两个人$A$和$B$，其中一人是罪犯。现在知道犯罪分子是特殊的$T$型血，人群中有百分之五的人是$T$型血。如果$A$是这种血型，那么是犯罪分子的概率是多少？  
**Proof.** 
